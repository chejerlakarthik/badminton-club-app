"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const create_court_1 = require("../../app/lambdas/courts/create-court");
const database_1 = require("../../app/utils/database");
const response_1 = require("../../app/utils/response");
const auth_1 = require("../../app/utils/auth");
const vitest_1 = require("vitest");
vitest_1.vi.mock('../../app/utils/database');
vitest_1.vi.mock('../../app/utils/response');
vitest_1.vi.mock('../../app/utils/auth');
(0, vitest_1.describe)('Create Court Lambda Handler', () => {
    (0, vitest_1.beforeEach)(() => {
        vitest_1.vi.clearAllMocks();
    });
    (0, vitest_1.it)('returns success response when court is created successfully', async () => {
        const mockEvent = {
            body: JSON.stringify({
                name: 'Court 1',
                type: 'indoor',
                hourlyRate: 50,
                description: 'A great indoor court'
            }),
        };
        auth_1.getUserFromEvent.mockReturnValue({ role: 'admin' });
        database_1.DatabaseService.put.mockResolvedValue(undefined);
        response_1.createSuccessResponse.mockReturnValue({ statusCode: 200 });
        const result = await (0, create_court_1.handler)(mockEvent);
        (0, vitest_1.expect)(result).toEqual({ statusCode: 200 });
        (0, vitest_1.expect)(database_1.DatabaseService.put).toHaveBeenCalled();
    });
    (0, vitest_1.it)('returns error response when request body is missing', async () => {
        const mockEvent = {};
        const result = await (0, create_court_1.handler)(mockEvent);
        (0, vitest_1.expect)(result).toEqual((0, response_1.createErrorResponse)(400, 'Request body is required'));
    });
    (0, vitest_1.it)('returns error response when user is not admin', async () => {
        const mockEvent = {
            body: JSON.stringify({
                name: 'Court 1',
                type: 'indoor',
                hourlyRate: 50
            }),
        };
        auth_1.getUserFromEvent.mockReturnValue({ role: 'user' });
        const result = await (0, create_court_1.handler)(mockEvent);
        (0, vitest_1.expect)(result).toEqual((0, response_1.createErrorResponse)(403, 'Admin access required'));
    });
    (0, vitest_1.it)('returns error response when validation fails', async () => {
        const mockEvent = {
            body: JSON.stringify({
                name: '',
                type: 'indoor',
                hourlyRate: -10
            }),
        };
        auth_1.getUserFromEvent.mockReturnValue({ role: 'admin' });
        const result = await (0, create_court_1.handler)(mockEvent);
        (0, vitest_1.expect)(result).toEqual((0, response_1.createErrorResponse)(400, 'Validation error'));
    });
    (0, vitest_1.it)('returns error response for unexpected errors', async () => {
        const mockEvent = {
            body: JSON.stringify({
                name: 'Court 1',
                type: 'indoor',
                hourlyRate: 50
            }),
        };
        auth_1.getUserFromEvent.mockReturnValue({ role: 'admin' });
        database_1.DatabaseService.put.mockRejectedValue(new Error('Unexpected error'));
        const result = await (0, create_court_1.handler)(mockEvent);
        (0, vitest_1.expect)(result).toEqual((0, response_1.createErrorResponse)(500, 'Internal server error'));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWNvdXJ0LnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvdGVzdHMvbGFtYmRhcy9jcmVhdGUtY291cnQudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHdFQUFnRTtBQUVoRSx1REFBMkQ7QUFDM0QsdURBQXNGO0FBQ3RGLCtDQUF3RDtBQUN4RCxtQ0FBb0U7QUFFcEUsV0FBRSxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3BDLFdBQUUsQ0FBQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQztBQUNwQyxXQUFFLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFFaEMsSUFBQSxpQkFBUSxFQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUN6QyxJQUFBLG1CQUFVLEVBQUMsR0FBRyxFQUFFO1FBQ1osV0FBRSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxXQUFFLEVBQUMsNkRBQTZELEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekUsTUFBTSxTQUFTLEdBQXlCO1lBQ3BDLElBQUksRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUNqQixJQUFJLEVBQUUsU0FBUztnQkFDZixJQUFJLEVBQUUsUUFBUTtnQkFDZCxVQUFVLEVBQUUsRUFBRTtnQkFDZCxXQUFXLEVBQUUsc0JBQXNCO2FBQ3RDLENBQUM7U0FDRSxDQUFDO1FBRVIsdUJBQW9DLENBQUMsZUFBZSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDeEUsMEJBQWUsQ0FBQyxHQUF1QixDQUFDLGlCQUFpQixDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JFLGdDQUF5QyxDQUFDLGVBQWUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBRWhGLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxzQkFBTyxFQUFD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LENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGhhbmRsZXIgfSBmcm9tICcuLi8uLi9hcHAvbGFtYmRhcy9jb3VydHMvY3JlYXRlLWNvdXJ0JztcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBEYXRhYmFzZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9hcHAvdXRpbHMvZGF0YWJhc2UnO1xuaW1wb3J0IHsgY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlLCBjcmVhdGVFcnJvclJlc3BvbnNlIH0gZnJvbSAnLi4vLi4vYXBwL3V0aWxzL3Jlc3BvbnNlJztcbmltcG9ydCB7IGdldFVzZXJGcm9tRXZlbnQgfSBmcm9tICcuLi8uLi9hcHAvdXRpbHMvYXV0aCc7XG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgdmksIE1vY2sgfSBmcm9tICd2aXRlc3QnO1xuXG52aS5tb2NrKCcuLi8uLi9hcHAvdXRpbHMvZGF0YWJhc2UnKTtcbnZpLm1vY2soJy4uLy4uL2FwcC91dGlscy9yZXNwb25zZScpO1xudmkubW9jaygnLi4vLi4vYXBwL3V0aWxzL2F1dGgnKTtcblxuZGVzY3JpYmUoJ0NyZWF0ZSBDb3VydCBMYW1iZGEgSGFuZGxlcicsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgdmkuY2xlYXJBbGxNb2NrcygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgc3VjY2VzcyByZXNwb25zZSB3aGVuIGNvdXJ0IGlzIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBtb2NrRXZlbnQ6IEFQSUdhdGV3YXlQcm94eUV2ZW50ID0ge1xuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdDb3VydCAxJyxcbiAgICAgICAgICAgICAgICB0eXBlOiAnaW5kb29yJyxcbiAgICAgICAgICAgICAgICBob3VybHlSYXRlOiA1MCxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0EgZ3JlYXQgaW5kb29yIGNvdXJ0J1xuICAgICAgICAgICAgfSksXG4gICAgICAgIH0gYXMgYW55O1xuXG4gICAgICAgIChnZXRVc2VyRnJvbUV2ZW50IGFzIHVua25vd24gYXMgTW9jaykubW9ja1JldHVyblZhbHVlKHsgcm9sZTogJ2FkbWluJyB9KTtcbiAgICAgICAgKERhdGFiYXNlU2VydmljZS5wdXQgYXMgdW5rbm93biBhcyBNb2NrKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuICAgICAgICAoY3JlYXRlU3VjY2Vzc1Jlc3BvbnNlIGFzIHVua25vd24gYXMgTW9jaykubW9ja1JldHVyblZhbHVlKHsgc3RhdHVzQ29kZTogMjAwIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIobW9ja0V2ZW50KTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKHsgc3RhdHVzQ29kZTogMjAwIH0pO1xuICAgICAgICBleHBlY3QoRGF0YWJhc2VTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgZXJyb3IgcmVzcG9uc2Ugd2hlbiByZXF1ZXN0IGJvZHkgaXMgbWlzc2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0V2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IHt9IGFzIGFueTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKG1vY2tFdmVudCk7XG5cbiAgICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChjcmVhdGVFcnJvclJlc3BvbnNlKDQwMCwgJ1JlcXVlc3QgYm9keSBpcyByZXF1aXJlZCcpKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGVycm9yIHJlc3BvbnNlIHdoZW4gdXNlciBpcyBub3QgYWRtaW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tFdmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQgPSB7XG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZTogJ0NvdXJ0IDEnLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdpbmRvb3InLFxuICAgICAgICAgICAgICAgIGhvdXJseVJhdGU6IDUwXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSBhcyBhbnk7XG5cbiAgICAgICAgKGdldFVzZXJGcm9tRXZlbnQgYXMgdW5rbm93biBhcyBNb2NrKS5tb2NrUmV0dXJuVmFsdWUoeyByb2xlOiAndXNlcicgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihtb2NrRXZlbnQpO1xuXG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwoY3JlYXRlRXJyb3JSZXNwb25zZSg0MDMsICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBlcnJvciByZXNwb25zZSB3aGVuIHZhbGlkYXRpb24gZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1vY2tFdmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQgPSB7XG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgbmFtZTogJycsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2luZG9vcicsXG4gICAgICAgICAgICAgICAgaG91cmx5UmF0ZTogLTEwXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgfSBhcyBhbnk7XG5cbiAgICAgICAgKGdldFVzZXJGcm9tRXZlbnQgYXMgdW5rbm93biBhcyBNb2NrKS5tb2NrUmV0dXJuVmFsdWUoeyByb2xlOiAnYWRtaW4nIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIobW9ja0V2ZW50KTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGNyZWF0ZUVycm9yUmVzcG9uc2UoNDAwLCAnVmFsaWRhdGlvbiBlcnJvcicpKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGVycm9yIHJlc3BvbnNlIGZvciB1bmV4cGVjdGVkIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgbW9ja0V2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCA9IHtcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnQ291cnQgMScsXG4gICAgICAgICAgICAgICAgdHlwZTogJ2luZG9vcicsXG4gICAgICAgICAgICAgICAgaG91cmx5UmF0ZTogNTBcbiAgICAgICAgICAgIH0pLFxuICAgICAgICB9IGFzIGFueTtcblxuICAgICAgICAoZ2V0VXNlckZyb21FdmVudCBhcyB1bmtub3duIGFzIE1vY2spLm1vY2tSZXR1cm5WYWx1ZSh7IHJvbGU6ICdhZG1pbicgfSk7XG4gICAgICAgIChEYXRhYmFzZVNlcnZpY2UucHV0IGFzIHVua25vd24gYXMgTW9jaykubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdVbmV4cGVjdGVkIGVycm9yJykpO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIobW9ja0V2ZW50KTtcblxuICAgICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKGNyZWF0ZUVycm9yUmVzcG9uc2UoNTAwLCAnSW50ZXJuYWwgc2VydmVyIGVycm9yJykpO1xuICAgIH0pO1xufSk7Il19